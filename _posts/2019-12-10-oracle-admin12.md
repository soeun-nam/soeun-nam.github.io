---
layout: post
title: ORACLE ADMIN 07
excerpt: "오라클 N/W관리 알아보기."
categories: [ORACLE ADMINISTRATION]
comments: true
---


# TABLE A CONTENT
 
> 오라클 네트워트 구성
   
> 리스너의 서비스 등록방법 : Dynamic, Static 
  
> 접속 방법 4가지     

> Shared Server    

> DB link 생성

## 오라클 네트워크 구성  

client         ----->    server    
Oracle Net    <------   Oracle Net    
tnsnames.ora            listener.ora    
                        tnsnames.ora- 동적등록

*CLIENT측과 SERVER측 양쪽에 각각 ORACLE NET이 존재함      
*항상 LISTNER가 실행되어 있어야하며, SERVER측에 LISTENER를 띄울 수 있는 LISTENER.ORA가 CLIENT측에는 TNSNAMES.ORA가 존재해야함						

sqlnet.ora  		   sqlnet.ora   
user process -------> server process , PGA    
                       connection    
					   username/password - session    
					   
tns : Transparent Network Substrate    
1) nw protocol    
2) ip addr(hostname)    
3) port : 1521  ( 1024- 65536)    
4) SID or service_name    
5,6) username / password    

{% highlight css %}
SYS@orcl> show parameter db_name
NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
db_name                              string      orcl

SYS@orcl> show parameter db_domain


NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
db_domain                            string      example.com


[orcl2:~]$ cd /u01/app/oracle/product/11.2.0/dbhome_1/network/admin/
[orcl2:admin]$ ls
samples  shrept.lst  tnsnames.ora

[orcl2:admin]$ cat tnsnames.ora
# tnsnames.ora Network Configuration File: /u01/app/oracle/product/11.2.0/dbhome_1/network/admin/tnsnames.ora
# Generated by Oracle configuration tools.

ORCL2 =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = edydr1p0.us.oracle.com)(PORT = 1521))
    (CONNECT_DATA =
      (SERVER = DEDICATED)
      (SERVICE_NAME = orcl2.example.com)
    )
  )

ORCL =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = edydr1p0.us.oracle.com)(PORT = 1521))
    (CONNECT_DATA =
      (SERVER = DEDICATED)
      (SERVICE_NAME = orcl.example.com)
    )
  )                   -- 접속할 수 잇는 connection descript가 저장


[orcl2:admin]$ sqlplus hr/hr

[+ASM:admin]$ ps -ef|grep orcl2
...
oracle    7650  7649  0 11:18 ?        00:00:00 oracleorcl2 (DESCRIPTION=(LOCAL=YES)(ADDRESS=(PROTOCOL=beq)))
...

[orcl2:admin]$ sqlplus hr/hr@orcl2 --리스너 통해 접속

[+ASM:admin]$ ps -ef|grep orcl2
...
oracle    7624     1  0 11:17 ?        00:00:00 oracleorcl2 (LOCAL=NO)
...

[orcl2:~]$ netca  --netca를 통해서 orcl2_new를 생성

[orcl2:admin]$ sqlplus hr/hr@orcl2_new
SQL*Plus: Release 11.2.0.1.0 Production on Wed Dec 10 14:05:03 2019
Copyright (c) 1982, 2009, Oracle.  All rights reserved.

Connected to:
Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options
{% endhighlight %}

## 리스너의 서비스 등록 방법 : Dynamic/Static  Resistration   

1. Dynamic registration     
 * lprotocol, hostname, port      
 * listener.ora 파일 안에 정보가 3가지만 있는 경우 -> db를 startup 할 때 pmon이 listener에게 service name등록    
 * pmon이 빨리 등록을 못한다면 alter system register;를 통해 수동 등록
 * db 서버측에 tnsnames.ora는 동적 등록을 위해 필요   
 * client측의 tnsnames.ora는 서버 연결을 위해 필요 
 
2. Static registration    
 * protocol, hostname, port, SID   
 * listener.ora 파일 안에 정보가 4가지가 다 있는 경우    
 
{% highlight css %}

[orcl2:admin]$ netmgr   --netmgr을 통해 서비스 등록

[orcl2:admin]$ sqlplus hr/hr@a
SQL*Plus: Release 11.2.0.1.0 Production on Wed Dec 10 16:23:14 2019
Copyright (c) 1982, 2009, Oracle.  All rights reserved.

Connected to:
Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options

[+ASM:admin]$ lsnrctl status
[+ASM:admin]$ lsnrctl service

[+ASM:admin]$ lsnrctl stop
LSNRCTL for Linux: Version 11.2.0.1.0 - Production on 10-DEC-2019 16:40:23 
Copyright (c) 1991, 2009, Oracle.  All rights reserved.

Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=EXTPROC1521)))
The command completed successfully   -- 리스너를 내리는 작업

[orcl2:admin]$ sqlplus hr/hr@a
SQL*Plus: Release 11.2.0.1.0 Production on Wed Mar 27 16:52:53 2019
Copyright (c) 1982, 2009, Oracle.  All rights reserved.
ERROR:
ORA-12541: TNS:no listener --ERROR 발생

[+ASM:admin]$ lsnrctl start
[orcl2:admin]$ sqlplus hr/hr@a
SQL*Plus: Release 11.2.0.1.0 Production on Wed DEC 10 17:01:23 2019
Copyright (c) 1982, 2009, Oracle.  All rights reserved.

ERROR:
ORA-12514: TNS:listener does not currently know of service requested in connect
descriptor
-- 리스너가 켜지고 등록되는 시간이 조금 걸리기 때문에 잠시후 다시 시도하면 정상 접속 가능

[+ASM:admin]$ lsnrctl      
LSNRCTL for Linux: Version 11.2.0.1.0 - Production on 10-DEC-2019 17:04:55

Copyright (c) 1991, 2009, Oracle.  All rights reserved.
Welcome to LSNRCTL, type "help" for information.
LSNRCTL>
{% endhighlight %}

## 접속방법 4가지 

 * easy connect  
  sqlplus scott/tiger@host:port/service_name  
  tnsname.ora가 필요없으며, tcp만 지원 (고급 연결 옵션 사용 불가능)  
 
 * local naming  
 client의 tnsnames.ora에 서비스 orcl2 = (description......) : Alias = connection descriptor를 기술하는 방식   
 접속하려는 서버에 대한 주소 정보가 바뀌면 관리가 어려워짐   
 
 * directory naming   
 directory server에 접속하려는 모든 서버들의 정보를 관리하는 방식   
 모든 oracle net 프로토콜 지원   
 

 * external naming  
 oracle이 아닌 다른 벤더사의 directory 서버를 쓰는 방식  
 비오라클 이름 지정 서비스 사용   
 
## SHARED SERVER 환경설정   
 
 * dispatcher 설정
   alter system set dispatchers=    
   "(protocol=tcp)(dispatchers=5)";    
   alter system set max_dispatchers=10;   
   
  * shared server 설정    
    alter system set shared_servers=3;   
	alter system set max_shared_servers=10;   

 * tnsnames.ora    
    orcl_d =.... (connect_data=(server=dedicated)...)   
	orcl_s =  서버의 설정대로     
	
 * listener에 dispatcher 가 등록된 것을 확인    
   lsnrctl service	- +ASM에서 조회해야됨    
   show parameter dispatche   
   show parameter shared_server    
   select * from v$dispatcher;    

 * TEST    
  session1) sqlplus scott/tiger@orcl_d    
  session2)sqlplus scott/tiger@orcl_s    
  DBA session ) select sid, username, server    
                from v$session   
			    where username ='SCOTT';   


{% highlight css %}				
-- dispatcher 설정
SYS@orcl> show parameter dispatcher

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
dispatchers                          string      (PROTOCOL=TCP) (SERVICE=orclXDB)
max_dispatchers                      integer

SYS@orcl> show parameter shared server(shared_servers, max 확인) 

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
hi_shared_memory_address             integer     0
max_shared_servers                   integer

--디스패쳐 5개로 지정 
SYS@orcl> alter system set dispatchers="(protocol=tcp)(dispatchers=5)";
--디스패쳐 최대 10개로 지정 
SYS@orcl> alter system set max_dispatchers=10;
SYS@orcl> show parameter dispatchers  (디스패처 개수 확인) 

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
dispatchers                          string      (protocol=tcp)(dispatchers=5)
max_dispatchers                      integer     10

--shared server 설정
SYS@orcl> alter system set shared_servers = 3; 
SYS@orcl> alter system set max_shared_servers=10; 
SYS@orcl> show parameter shared_servers

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
max_shared_servers                   integer     10
shared_servers                       integer     3

--디스패처 프로세스 확인
SYS@orcl> !ps -ef|grep d00
oracle    5704     1  0 13:58 ?        00:00:00 ora_d000_orcl
oracle    7857     1  0 16:48 ?        00:00:00 ora_d001_orcl
oracle    7861     1  0 16:48 ?        00:00:00 ora_d002_orcl
oracle    7865     1  0 16:48 ?        00:00:00 ora_d003_orcl
oracle    7867     1  0 16:48 ?        00:00:00 ora_d004_orcl
oracle    8191  7839  0 17:27 pts/1    00:00:00 /bin/bash -c ps -ef|grep d00
oracle    8193  8191  0 17:27 pts/1    00:00:00 grep d00

--서버 프로세스 확인
SYS@orcl> !ps -ef|grep s00
oracle    5706     1  0 13:58 ?        00:00:00 ora_s000_orcl
oracle    8174     1  0 17:25 ?        00:00:00 ora_s001_orcl
oracle    8178     1  0 17:25 ?        00:00:00 ora_s002_orcl
oracle    8194  7839  0 17:27 pts/1    00:00:00 /bin/bash -c ps -ef|grep s00
oracle    8196  8194  0 17:27 pts/1    00:00:00 grep s00
--
[orcl:admin]$ cd $ORACLE_HOME/network/admin
[orcl:admin]$ vi tnsnames.ora
/*
기존에 있던 lys2를 orcl_s로 변경
기존에 있던 cho를 orcl_d로 변경
orcl_d에 server = dedicated
port = 1521, host, service_name 확인
*/
[orcl:admin]$ sqlplus hr/hr@orcl_s
SQL*Plus: Release 11.2.0.1.0 Production on Wed Dec 11 17:35:03 2019
Copyright (c) 1982, 2009, Oracle.  All rights reserved

--리스너 관리
HR@orcl_s> !lsnrctl ser
LSNRCTL for Linux: Version 11.2.0.1.0 - Production on 11-DEC-2019 17:36:29
Copyright (c) 1991, 2009, Oracle.  All rights reserved.
Connecting to (ADDRESS=(PROTOCOL=tcp)(HOST=)(PORT=1521))
Services Summary...
.
.
Service "orclXDB.example.com" has 1 instance(s).
  Instance "orcl", status READY, has 0 handler(s) for this service...
The command completed successfully
{% endhighlight %}

## DB LINK 생성   

 XE ---------------> orcl			--> XE는 윈도우환경 hr유저       
   hr                  scott.emp    
   create database link orcl_db    
   connect to  scott identified by tiger    
   using 'orcl';		--> orcl_db는 링크이름을 정해준것. 'orcl'은 윈도우에서 tnsnames파일에 있는 리눅스로 연결하는 tns alias를 입력
 
 * server에서 server로 연결하려면 DB링크가필요    
 * 윈도우환경 client에서 리눅스의 DB서버로 접속하려면 tnsnames파일에 연결을 추가 하고 cmd에서 sqlplus hr/hr@orcl 입력해서 접속   
 * tnsnames경로(C:\oraclexe\app\oracle\product\11.2.0\server\network\ADMIN)   
  ORCL =
   (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.56.101)(PORT = 1521))
    (CONNECT_DATA =
      (SERVER = DEDICATED)
      (SERVICE_NAME = orcl.example.com)
    )
  )	-->  이걸 tnsnames에 추가 그러면 직접 접속가능
  
{% highlight css %}

--DB링크 생성
cmd) sqlplus hr/hr
select * from session_privs;(create database link확인--있어야 만들 수있음 ) 
create database link orcl_db connect to scott identified by tiger using 'orcl'; (아까 XE에서 만든 이름이랑 같아야함 'orcl')
-> select * from emp2; (하면 당연히 안됨) 
-> select * from emp2@orcl_db; (하면 터미널에서 만들었던 emp2 불러올 수 있음)
->create table orcl_emp2 as select * from emp2@orcl_db where deptno=10; 
-> select * from orcl_emp2;

[cmd] ping 192.168.56.101 (살아있는지 확인하는거) -> tnsping orcl (경로 찾아가는지 확인하는거)

--XE...orclxe
[cmd] sqlplus hr/hr -> select * from employees; -> select * from emp2 (서버SCOTT에 있는 emp2--그래서 없는거 당연)
([터미널(SCOTT)]) create table emp2 as select * from emp;

[cmd] select * from session_privs;(create database link확인--있어야 만들 수있음 ) -> create database link orcl_db connect to scott identified by tiger using 'orcl'; (아까 XE에서 만든 이름이랑 같아야함 'orcl')
-- select * from emp2; (하면 당연히 안됨) -> select * from emp2@orcl_db; (하면 터미널에서 만들었던 emp2 불러올 수 있음)
-- (리모트에 있는 데이터를 가져와서 저장하기) create table orcl_emp2 as select * from emp2@orcl_db where deptno=10; -> select * from orcl_emp2;

[cmd] ping 192.168.56.101 (살아있는지 확인하는거) -> tnsping orcl (경로 찾아가는지 확인하는거)
[cmd] sqlplus hr/hr@orcl -> exit			//sqlplus hr/hr@orcl 랑 sqlplus hr/hr 이 다른거 이해해야해
sqlplus hr/hr -> select * from dept@orcl_db; -> select * from user_db_links; (프라이빗 디비 링크임)

--synonym(긴 이름 짧게 만드는 것)의 목적 : 보안성과 편의성 (db링크를 숨기면서 보안성 높이고, 코드의 유지관리 쉬워짐)
[cmd] SQL> select * from emp2@orcl_db; 하면 리모트에 있는거 들킴 그러기 싫으면 시노님 만들면 됨
-> select * from emp2; (하면 안됨) -> create synonym emp2 for emp2@orcl_db; (emp2@orcl_db를 emp2로 바꿔) -> select * from emp2;(해도 조회 됨)
-> select * from emp; 는 로컬에 있는 데이터 emp 읽은거, select * from emp2;는 리모트에 있는 데이터 emp2 가져와서 조회한 것 
-> select * from synonyms; (시노님 조회)
{% endhighlight %}


## Buttons

Make any link standout more when applying the `.btn` class.

{% highlight html %}
<a href="#" class="btn btn-success">Success Button</a>
{% endhighlight %}

<div markdown="0"><a href="#" class="btn btn-info">Info Button</a></div>

## Notices

**Watch out!** You can also add notices by appending `{: .notice}` to a paragraph.
{: .notice}
